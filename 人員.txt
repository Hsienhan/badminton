<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>äººå“¡ç®¡ç† - é›²ç«¯å³æ™‚ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4 bg-slate-50 min-h-screen">
    <div class="max-w-md mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-black italic text-slate-800 uppercase">Member Cloud</h2>
            <button onclick="fetchFromNotion()" id="syncBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-xl font-bold text-[10px] shadow-md italic">
                ğŸ”„ é‡æ–°æ•´ç†åå–®
            </button>
        </div>

        <div class="bg-white p-4 rounded-3xl shadow-lg mb-8 flex gap-3 border border-slate-100">
            <input type="text" id="nameInp" placeholder="è¼¸å…¥å§“å..." class="flex-1 bg-slate-50 p-4 rounded-2xl outline-none font-bold text-sm">
            <button onclick="addNewMember()" id="addBtn" class="bg-slate-800 text-white px-6 rounded-2xl font-bold text-sm shadow-md">æ–°å¢</button>
        </div>

        <div id="list" class="space-y-3">
            <p class="py-20 text-center text-slate-300 font-bold italic animate-pulse">CONNECTING TO CLOUD...</p>
        </div>
    </div>

    <script>


        const GAS_URL = "https://script.google.com/macros/s/AKfycbyrT9Pd4Ry2dNDhP3fLbV-fI5t77WhPtbwY9hrC5YLUIu9zGmETjcMLImNU3Xx_xV4O/exec"; 


        let members = [];

        // é–‹å•Ÿé é¢å³åŸ·è¡Œè®€å–
        async function fetchFromNotion() {
            const listArea = document.getElementById('list');
            const syncBtn = document.getElementById('syncBtn');
            syncBtn.innerHTML = "âŒ› è®€å–ä¸­...";
            
            try {
                // ç™¼é€ GET è«‹æ±‚
                const response = await fetch(GAS_URL);
                members = await response.json();
                render();
                syncBtn.innerHTML = "ğŸ”„ é‡æ–°æ•´ç†åå–®";
            } catch (e) {
                listArea.innerHTML = `<div class="text-center py-20 text-red-400 font-bold">è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª GAS éƒ¨ç½²ç‰ˆæœ¬ã€‚</div>`;
                syncBtn.innerHTML = "ğŸ”„ é‡æ–°æ•´ç†åå–®";
            }
        }

        async function addNewMember() {
            const inp = document.getElementById('nameInp');
            const btn = document.getElementById('addBtn');
            const name = inp.value.trim();
            if (!name) return;

            btn.innerHTML = "...";
            btn.disabled = true;

            try {
                await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ name: name }) });
                inp.value = '';
                await fetchFromNotion(); // æ–°å¢æˆåŠŸå¾Œç«‹å³åˆ·æ–°åå–®
            } catch (e) {
                alert("å¯«å…¥å¤±æ•—");
            } finally {
                btn.innerHTML = "æ–°å¢";
                btn.disabled = false;
            }
        }

        function render() {
            const listArea = document.getElementById('list');
            if (members.length === 0) {
                listArea.innerHTML = `<p class="py-20 text-center text-slate-300 font-bold italic">NOTION åå–®ç‚ºç©º</p>`;
                return;
            }
            listArea.innerHTML = members.map(m => `
                <div class="bg-white p-5 rounded-2xl flex justify-between items-center shadow-sm border border-slate-50">
                    <span class="font-bold text-slate-700">${m.name}</span>
                    <span class="text-[9px] font-black italic text-emerald-500 bg-emerald-50 px-2 py-1 rounded-md">âœ“ CLOUD</span>
                </div>
            `).join('');
        }

        fetchFromNotion();
    </script>
</body>
</html>